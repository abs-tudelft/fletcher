branches:
  only:
  - master

sudo: required

language: minimal

services:
  - docker

env:
  global:
    - ARROW_VERSION=0.11.1

jobs:
  include:

    - &docker-build
      stage: build
      name: fletcher
      script:
        - docker build -t fletcher --build-arg ARROW_VERSION=$ARROW_VERSION .

    - &vhdl
      name: vhdl-93c
      env: STD=93c
      script:
        # this imports all entities in vhdl/ and runs analysis and elaboration
        - docker run --rm -e STD -v `pwd`/hardware/vhdl:/src ghdl/ghdl:ubuntu18-llvm-5.0 bash -c "shopt -s globstar && ghdl -i -v --std=$STD /src/**/*.vhd | grep entity | sed -e 's/entity //' | sed -e 's/ \*\*//' | xargs -L 1 ghdl -m --std=$STD --ieee=synopsys"

    - <<: *vhdl
      name: vhdl-08
      env: STD=08
